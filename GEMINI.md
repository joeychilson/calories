# GEMINI.md

This file provides context and instructions for the Gemini AI agent when working with the **Calories** project.

## Project Overview

**Calories** is an AI-powered nutrition tracking application built with SvelteKit. It allows users to:

- Log meals via text or photo analysis (using AI).
- Track calories, macros (protein, carbs, fat), weight, and water intake.
- Manage a digital pantry and get recipe suggestions.
- Interact with an AI food assistant for personalized advice.
- Manage subscriptions (via Stripe, optional).

The project is designed to be either self-hosted or deployed as a SaaS.

## Tech Stack

- **Runtime:** [Bun](https://bun.sh/) (Package manager & runtime)
- **Framework:** [SvelteKit](https://kit.svelte.dev/) (Full-stack)
- **Language:** TypeScript
- **Styling:** Tailwind CSS v4
- **UI Components:** [shadcn-svelte](https://shadcn-svelte.com/) (built on bits-ui)
- **Database:** PostgreSQL
- **ORM:** [Drizzle ORM](https://orm.drizzle.team/)
- **Authentication:** [Better Auth](https://www.better-auth.com/) (Google OAuth)
- **AI:** Vercel AI SDK with AI Gateway (Anthropic models)
- **Payments:** Stripe (optional)

## Key Directories & Files

- `src/lib/server/schema.ts`: **CRITICAL**. Defines the entire database schema (Users, Logs, Pantry, etc.). Consult this before writing any DB queries.
- `src/lib/server/tools.ts`: Defines the tools available to the AI assistant (e.g., `logWeight`, `suggestFood`).
- `src/lib/remote/`: Contains "Remote Functions" - server-side logic callable from the client (e.g., `meals.remote.ts` for adding meals).
- `src/routes/`: SvelteKit routes.
  - `(app)`: Protected application routes (Dashboard, Account).
  - `(auth)`: Authentication routes.
  - `api/assistant`: The AI chat endpoint.
- `migrations/`: Database migration files generated by Drizzle.

## Development Workflow

### 1. Setup & Run

- **Install dependencies:** `bun install`
- **Start development server:** `bun run dev`
- **Build for production:** `bun run build`

### 2. Database Management

- **Generate migrations:** `bun run db:generate` (Run this after modifying `schema.ts`)
- **Apply migrations:** `bun run db:migrate` (Applies changes to the local DB)

### 3. Code Quality

- **Type Check:** `bun run check`
- **Lint:** `bun run lint`
- **Format:** `bun run format`

## Coding Conventions

- **Package Manager:** Always use `bun` instead of `npm` or `yarn`.
- **Database Access:** Use Drizzle ORM (`src/lib/server/db.ts`). Do not write raw SQL unless absolutely necessary.
- **Server Actions:** Prefer the "Remote Functions" pattern located in `src/lib/remote/*.ts` for mutations and data fetching logic that needs to be shared or strictly typed between client/server.
- **UI Components:** Reuse existing `shadcn-svelte` components in `src/lib/components/ui` whenever possible.
- **Styling:** Use Tailwind CSS utility classes.
- **Formatting:** Adhere strictly to the project's Prettier configuration.

## Remote Functions Pattern

The project uses a specific pattern for server-client communication called "Remote Functions".

- **Definition:** `src/lib/remote/[feature].remote.ts`
- **Usage:** `export const myAction = command(schema, async (input) => { ... })`
- **Client Call:** `import { myAction } from '$lib/remote/...'`

## AI Integration

The AI features are centralized in `src/lib/server/ai.ts` (image analysis) and `src/routes/api/assistant` (chat). New tools for the assistant should be added to `src/lib/server/tools.ts`.
